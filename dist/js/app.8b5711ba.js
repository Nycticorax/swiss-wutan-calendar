(function(e){function t(t){for(var s,o,r=t[0],l=t[1],c=t[2],u=0,v=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&v.push(i[o][0]),i[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(v.length)v.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(s=!1)}s&&(n.splice(t--,1),e=o(o.s=a[0]))}return e}var s={},i={app:0},n=[];function o(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=s,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(a,s,function(t){return e[t]}.bind(null,s));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=l;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",{attrs:{app:""}},[a("v-toolbar-title",{staticClass:"headline text-uppercase"},[a("span",{staticClass:"font-weight-light"},[e._v("SWISS WUTAN CALENDAR")])]),a("v-spacer"),a("span",{staticClass:"mr-2"},[e._v("Beta version, feedback "),a("a",{attrs:{href:"mailto:mrnycticorax@gmail.com"}},[e._v("here")]),e._v(".")])],1),a("v-content",[a("Singleton")],1)],1)},n=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-content",[a("v-card",{staticStyle:{position:"fixed",right:"0",margin:"0",padding:"0","z-index":"9999"},attrs:{raised:"",outlined:"",dark:""}},[a("v-navigation-drawer",{attrs:{"expand-on-hover":"",permanent:""},model:{value:e.nav,callback:function(t){e.nav=t},expression:"nav"}},[a("v-list-item",[a("v-list-item-title",[e._v("NAV")]),a("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.nav=!e.nav}}},[a("v-icon",[e._v("mdi-chevron-left")])],1)],1),a("v-divider"),a("v-list",{attrs:{dense:"",rounded:""}},e._l(e.navItems,(function(t){return a("v-list-item",{key:t.name,attrs:{link:""}},[a("v-list-item-content",[a("v-list-item-title",{on:{click:function(a){return e.$vuetify.goTo(t.target)}}},[e._v(e._s(t.title))])],1)],1)})),1)],1)],1),a("v-content",[a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"intro",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Introduction")])],1),a("v-card-text",[a("p",[e._v("\n            The goal of this page is to demo a workable, in-house\n            alternative to Facebook for managing Swiss Wutan's events. Reasons to go all-in with\n            Facebook are (a) Facebook is the ultimate owner of the content it hosts; (b) Facebook\n            has a\n            poor record in protecting users' privacy, (c) Facebook is extremely opaque and has poor\n            programming interfaces and finally (d) it's always good not to put all one's eggs in the\n            same basket, i.e. not assume everyone likes to use Facebook for managing\n            community-driven time schedules. And if you still are in love with Facebook you can use\n            "),a("a",{attrs:{href:"https://www.facebook.com/help/152652248136178/"}},[e._v("these instructions")]),e._v(" to\n            export Facebook's events to Google Calendar.\n          ")]),a("p",[e._v("Onto the concept. It works like this.")]),a("ol",[a("li",[e._v("\n              Anyone -- perhaps an individual or\n              institutional member of Swiss Wutan, but not necessarily -- can submit events to\n              the\n              SWISS WUTAN CALENDAR -- displayed here below\n            ")]),a("li",[e._v("\n              Submitted events don't need to be organized by Swiss Wutan or affiliates. They\n              can just be interested for our community, or for some schools, etc. It's very\n              easy with this setup to create different categories for events, and to search\n              them smoothly.\n            ")]),a("li",[e._v('\n              People vested with an\n              "admin" role can accept or reject events submissions. This process is explained\n              below.\n            ')])]),e._v("At the end of the day this removes all the bureaucratic shenanigans so that we can all\n          focus on what matters --\n          "),a("em",[e._v("Wutan!")]),e._v(" (For the curious, source code is sleeping\n          "),a("a",{attrs:{href:"https://github.com/Nycticorax/swiss-wutan-calendar"}},[e._v("here")]),e._v(".)\n        ")])],1)],1),a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"auth",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Authenticate on Google Calendar")])],1),a("v-card",{staticClass:"d-flex pa-2",attrs:{outlined:"",tile:""}},[a("v-card-actions",[e.authorized?a("v-btn",{on:{click:function(t){return e.signOut()}}},[e._v("Log out")]):a("v-btn",{on:{click:function(t){return e.signIn()}}},[e._v("Log in")])],1),a("v-card-text",[e._v("\n            Acquire admin credentials here. Please note that you will need a Google Account\n            to make the most of this demo. Email + password login will be available.\n          ")])],1)],1)],1),a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"manage",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Accept or reject events submissions")])],1),a("v-card-text",[e._v("\n          This section lets you switch between events submitted but not yet\n          validated (i.e. accepted or rejected) and events already scheduled events.\n        ")]),a("v-card",{staticClass:"d-flex pa-2",attrs:{outlined:"",tile:""}},[a("v-tabs",{attrs:{color:"red darken-2",vertical:""},model:{value:e.active_tab,callback:function(t){e.active_tab=t},expression:"active_tab"}},[a("v-tab",{key:"0"},[e._v("Submitted events")]),a("v-tab",{key:"1"},[e._v("Scheduled events")]),a("v-tab-item",{key:"0"},[a("v-card",{attrs:{flat:""}},[e.authorized?a("div",[a("v-card-title",[a("v-text-field",{attrs:{label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e.submittedEvents?a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.submittedEvents_headers,items:e.submittedEvents,"show-select":"","sort-by":"start.dateTime","sort-desc":!0,"item-key":"id",search:e.search,"items-per-page":10},model:{value:e.selectedEvents,callback:function(t){e.selectedEvents=t},expression:"selectedEvents"}}):e._e()],1):a("div",[a("v-card-text",[e._v("You need to be logged in to see submitted events.")])],1)])],1),a("v-tab-item",{key:"1"},[a("v-card",{attrs:{flat:""}},[a("v-card-title",[a("v-text-field",{attrs:{label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e.events?a("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.events_headers,items:e.events,"show-select":"","items-per-page":10,"sort-by":"start.dateTime","sort-desc":!0,"item-key":"id",search:e.search},model:{value:e.selectedEvents,callback:function(t){e.selectedEvents=t},expression:"selectedEvents"}}):e._e()],1)],1)],1)],1),e.selectedEvents.length>0?a("div",{attrs:{id:"subscribe"}},[a("v-divider"),e._l(e.selectedEvents,(function(t){return a("v-card",{key:t.id,staticClass:"mx-auto",attrs:{tile:""}},[a("v-card-title",[e._v(e._s(t.summary))]),a("v-list-item",[a("v-list-item-content",[a("v-list-item-title",[e._v(e._s(t.author||"author"))])],1)],1),a("v-list-item",[a("v-list-item-content",[a("v-list-item-title",[e._v(e._s(t.start.dateTime))])],1)],1),a("v-list-item",[a("v-list-item-content",[a("v-list-item-title",[e._v(e._s(t.end.dateTime||"no end specified"))])],1)],1),a("v-list-item",[a("v-list-item-content",[a("v-list-item-title",[e._v(e._s(t.location||"Wudan Mountains"))])],1)],1)],1)}))],2):e._e(),a("v-card-actions",[e.authorized&&0==e.active_tab&&e.selectedEvents.length>0?a("v-btn",{on:{click:function(t){return e.acceptSubmitted()}}},[e._v("Accept submitted event(s)")]):e.authorized?a("v-btn",{attrs:{disabled:""}},[e._v("\n            Accept submitted\n            event(s)\n          ")]):e._e(),e.authorized&&0==e.active_tab&&e.selectedEvents.length>0?a("v-btn",{on:{click:function(t){e.rejecting=!e.rejecting}}},[e._v("\n            Reject\n            submitted event(s)\n          ")]):e.authorized?a("v-btn",{attrs:{disabled:""}},[e._v("\n            Reject submitted\n            event(s)\n          ")]):e._e()],1)],1)],1),e.rejecting?a("v-dialog",{attrs:{persistent:"","max-width":"450"},model:{value:e.rejecting,callback:function(t){e.rejecting=t},expression:"rejecting"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[e._v("Explain why")]),a("v-textarea",{attrs:{"auto-grow":"",placeholder:"Please explain the submitter why you're rejecting.",rows:"4","row-height":"30"},model:{value:e.rejecting_why,callback:function(t){e.rejecting_why=t},expression:"rejecting_why"}}),a("v-card-actions",[a("div",{staticClass:"flex-grow-1"}),a("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(t){e.rejecting=!1,e.sendRejection()}}},[e._v("\n            Confirm &\n            send\n          ")]),a("v-btn",{attrs:{color:"orange darken-1",text:""},on:{click:function(t){e.rejecting=!1}}},[e._v("Cancel rejection")])],1)],1)],1):e._e(),a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"gCal",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Check the results")])],1),a("v-card-text",[a("p",[e._v('\n            This is NOT the actual calendar used to review and submit events (see below for the real\n            calendar). This is just the "official" interface Google provides for interacting with\n            events. I am putting it here simply to show that accepting submitted events works. By\n            the way it is visible by\n            anyone on\n            the internet -- no credentials required. Here\'s its\n            '),a("a",{attrs:{href:"https://calendar.google.com/calendar/embed?src=3mo0a639qfhs9tjc1idmu4kkus%40group.calendar.google.com&ctz=Europe%2FZurich"}},[e._v("\n              home\n              page\n            ")]),e._v(". Also, remember that Google Calendars have many\n            features:\n          ")]),a("ol",[a("li",[e._v("can share links to expose any calendar")]),a("li",[e._v("can link up any two calendars, so that can explose each other's events")]),a("li",[e._v("custom email & push notifications.")]),a("li",[e._v("\n              available on many different platforms --\n              Web, Android, iPhone\n            ")])]),a("p",[e._v("\n            If you have accepted events submissions you can now hit\n            "),a("v-btn",{on:{click:e.refreshFrame}},[e._v("reload")]),e._v("to see the results of the newly validated events.\n          ")],1)]),a("v-card",{staticClass:"d-flex pa-2",attrs:{outlined:"",tile:""}},[a("div",{key:e.iframe_key},[a("iframe",{staticStyle:{"border-width":"0"},attrs:{src:"https://calendar.google.com/calendar/embed?height=450&wkst=2&bgcolor=%23D50000&ctz=Europe%2FZurich&src=M21vMGE2MzlxZmhzOXRqYzFpZG11NGtrdXNAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&color=%23D50000&showTitle=1&showNav=1&showPrint=0&showTabs=0&showCalendars=0&showTz=0&mode=AGENDA&hl=de",width:"450",height:"450",frameborder:"0",scrolling:"no"}})])])],1)],1),a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"submit",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Submit new events")])],1),a("v-card-text",[e._v("\n          By contrast to the other sections of the page, this one will be visible to anyone\n          on the internet. People are supposed to use it to submit new events.\n        ")]),a("v-card",{staticClass:"d-flex pa-2",attrs:{outlined:"",tile:""}},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-text-field",{attrs:{counter:25,rules:e.firstNameRules,outlined:"",label:"First name",required:""},model:{value:e.author.firstName,callback:function(t){e.$set(e.author,"firstName",t)},expression:"author.firstName"}}),a("v-text-field",{attrs:{counter:25,rules:e.lastNameRules,outlined:"",label:"Last name",required:""},model:{value:e.author.lastName,callback:function(t){e.$set(e.author,"lastName",t)},expression:"author.lastName"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-text-field",{attrs:{rules:e.emailRules,label:"Email",required:"",outlined:""},model:{value:e.author.email,callback:function(t){e.$set(e.author,"email",t)},expression:"author.email"}}),a("v-text-field",{attrs:{rules:e.phoneRules,label:"Phone number",required:"",outlined:""},model:{value:e.author.phone,callback:function(t){e.$set(e.author,"phone",t)},expression:"author.phone"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-checkbox",{attrs:{color:"red darken-2",label:"I am submitting on behalf of a Swiss Wutan school"},model:{value:e.author.is_school,callback:function(t){e.$set(e.author,"is_school",t)},expression:"author.is_school"}}),e.author.is_school?a("v-select",{attrs:{items:e.schools_opts,label:"School",outlined:"",rules:[function(e){return!!e||"Deselect the previous checkbox or please do mention your school"}],required:""},model:{value:e.author.school,callback:function(t){e.$set(e.author,"school",t)},expression:"author.school"}}):e._e()],1),a("v-col",{staticClass:"my-2 px-1",attrs:{cols:"12",sm:"6"}},[a("v-date-picker",{ref:"picker",attrs:{multiple:"",color:"red darken-2","picker-date":e.pickerDate,"full-width":""},on:{"update:pickerDate":function(t){e.pickerDate=t},"update:picker-date":function(t){e.pickerDate=t}},model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}})],1),a("v-col",{staticClass:"my-2 px-1",attrs:{cols:"12",sm:"6"}},[a("div",{staticClass:"title"},[e._v("Real calendar for all users (not only admins)")]),a("div",{staticClass:"subheader"},[e._v("Switch to October to see the scheduled events.")]),a("ul",{staticClass:"ma-4"},e._l(e.thisMonthEvents,(function(t){return a("li",{key:t.id},[e._v(e._s(t.summary)+e._s(t.start.dateTime))])})),0),a("br"),a("br"),a("v-combobox",{attrs:{multiple:"",chips:"",items:e.dates,label:"Dates picked","deletable-chips":""},model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}}),a("v-text-field",{attrs:{label:"Time",type:"time"},model:{value:e.event.time,callback:function(t){e.$set(e.event,"time",t)},expression:"event.time"}})],1),a("v-col",{attrs:{cols:"12",md:"6"}},[a("v-text-field",{attrs:{label:"Event title",filled:"",required:""},model:{value:e.event.title,callback:function(t){e.$set(e.event,"title",t)},expression:"event.title"}}),a("v-select",{attrs:{items:e.levels_opts,label:"Suggested level(s)","deletable-chips":"",multiple:"",chips:""},model:{value:e.event.levels,callback:function(t){e.$set(e.event,"levels",t)},expression:"event.levels"}})],1),a("v-col",{attrs:{cols:"12",md:"6"}},[a("v-text-field",{attrs:{label:"Event location",filled:"",required:""},model:{value:e.event.location,callback:function(t){e.$set(e.event,"location",t)},expression:"event.location"}}),a("v-combobox",{attrs:{"deletable-chips":"",multiple:"",chips:"",items:e.arts_opts,label:"Featured styles"},model:{value:e.event.arts,callback:function(t){e.$set(e.event,"arts",t)},expression:"event.arts"}})],1),a("v-col",{attrs:{cols:"12",md:"6"}},[a("v-combobox",{attrs:{multiple:"",chips:"",items:e.topics_opts,label:"Topics","deletable-chips":""},model:{value:e.event.topics,callback:function(t){e.$set(e.event,"topics",t)},expression:"event.topics"}})],1),a("v-col",{attrs:{cols:"12",md:"6"}},[a("v-checkbox",{attrs:{color:"red darken-2",label:"This event is meant only for Swiss Wutan members"},model:{value:e.event.privacy,callback:function(t){e.$set(e.event,"privacy",t)},expression:"event.privacy"}}),a("v-checkbox",{attrs:{color:"red darken-2",label:"Registration required"},model:{value:e.event.registration,callback:function(t){e.$set(e.event,"registration",t)},expression:"event.registration"}}),e.event.registration?a("div",{attrs:{id:"register"}},[a("v-combobox",{attrs:{items:e.fillFromOpts,filled:"",label:"Participants register here (url, email):...."},model:{value:e.event.registration_details,callback:function(t){e.$set(e.event,"registration_details",t)},expression:"event.registration_details"}})],1):e._e(),a("v-checkbox",{attrs:{color:"red darken-2",label:"Swiss Wutan members get a special discount"},model:{value:e.event.discount,callback:function(t){e.$set(e.event,"discount",t)},expression:"event.discount"}})],1),a("v-container",{attrs:{fluid:""}},[a("v-textarea",{attrs:{label:"If appropriate please describe the event.","auto-grow":"",outlined:"",shaped:""},model:{value:e.event.comments,callback:function(t){e.$set(e.event,"comments",t)},expression:"event.comments"}})],1),a("v-btn",{staticClass:"mr-4",attrs:{disabled:!e.valid,color:"success"},on:{click:function(t){return e.submitEvent()}}},[e._v("Validate")]),a("v-btn",{staticClass:"mr-4",attrs:{color:"error"},on:{click:e.reset}},[e._v("Reset Form")]),a("v-btn",{attrs:{color:"warning"},on:{click:e.resetValidation}},[e._v("Reset Validation")])],1)],1)],1)],1)],1)],1),a("v-container",[a("v-card",[a("v-toolbar",{attrs:{id:"subscribe",flat:"",color:"red darken-2",dark:""}},[a("v-toolbar-title",[e._v("Subscribe")])],1),a("v-card-text",[e._v("\n          You need to be logged in to use this feature. Here users can manage their\n          subscriptions to 'topics', namely theme-related events\n          about which they want to be notified. Notifications can be sent as emails or web push. Play\n          around to see them in action.\n        ")]),a("v-divider"),a("v-form",[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",md:"4"}},[e.locked?a("v-text-field",{attrs:{readonly:"",outlined:"",filled:"",label:"Email",placeholder:e.user.gUserEmail||e.user.emailNotif||"","append-outer-icon":"mdi-lock-reset"},on:{"click:append-outer":e.lockUnlock},model:{value:e.user.emailNotif,callback:function(t){e.$set(e.user,"emailNotif",t)},expression:"user.emailNotif"}}):a("v-text-field",{attrs:{outlined:"",label:"Email",placeholder:e.user.gUserEmail||e.user.emailNotif||"Your email","append-outer-icon":"mdi-lock-reset"},on:{"click:append-outer":e.lockUnlock},model:{value:e.user.emailNotif,callback:function(t){e.$set(e.user,"emailNotif",t)},expression:"user.emailNotif"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-combobox",{attrs:{items:e.notifs_opts,multiple:"",chips:"","deletable-chips":"",label:"Notifications via"},model:{value:e.user.notifs_prefs,callback:function(t){e.$set(e.user,"notifs_prefs",t)},expression:"user.notifs_prefs"}}),a("v-combobox",{attrs:{items:e.reminders_opts,multiple:"",chips:"","deletable-chips":"",label:"Notifications when"},model:{value:e.user.reminders,callback:function(t){e.$set(e.user,"reminders",t)},expression:"user.reminders"}})],1),a("v-col",{attrs:{cols:"12",md:"4"}},[a("v-combobox",{attrs:{multiple:"",chips:"",items:e.topics_opts,label:"Topics","deletable-chips":""},model:{value:e.user.topics,callback:function(t){e.$set(e.user,"topics",t)},expression:"user.topics"}}),a("v-btn",{staticClass:"ma-2",attrs:{outlined:"",text:"",color:"primary"},on:{click:e.testEmail}},[e._v("Test email")]),a("v-btn",{staticClass:"ma-2",attrs:{outlined:"",text:"",color:"primary"},on:{click:e.testPush}},[e._v("\n                  Test web\n                  push\n                ")])],1)],1),e.authorized&&e.user.emailNotif!==e.user.gUserEmail?a("v-btn",{attrs:{color:"success"},on:{click:function(t){return e.subUnsub(!0)}}},[e._v("Subscribe")]):a("v-btn",{attrs:{disabled:"",color:"success"}},[e._v("Already subscribed")]),e.authorized&&e.user.emailNotif===e.user.gUserEmail?a("v-btn",{attrs:{color:"warning"},on:{click:function(t){return e.subUnsub(!1)}}},[e._v("Edit subscription")]):a("v-btn",{attrs:{disabled:"",color:"error"}},[e._v("Unsubscribe")])],1)],1)],1)],1)],1),e.newNotif?a("v-snackbar",{model:{value:e.notif_snackbar,callback:function(t){e.notif_snackbar=t},expression:"notif_snackbar"}},[e._v("\n    "+e._s(e.newNotif)+"\n    "),a("v-btn",{attrs:{color:"pink",text:""},on:{click:function(t){e.notif_snackbar=!1}}},[e._v("Close")])],1):e._e(),e.newWebPush?a("v-snackbar",{attrs:{"multi-line":"",right:"",color:"primary"},model:{value:e.push_snackbar,callback:function(t){e.push_snackbar=t},expression:"push_snackbar"}},[e._v("\n    "+e._s(e.newWebPush)+"\n    "),a("v-btn",{attrs:{color:"white",text:""},on:{click:function(t){e.push_snackbar=!1}}},[e._v("Close")])],1):e._e()],1)},r=[];const l=performance.now(),c={apiKey:"AIzaSyBn9ur32UG9DkmN74HYciXzcp7uoJ2hwuU",authDomain:"main-repo.firebaseapp.com",databaseURL:"https://main-repo.firebaseio.com",projectId:"main-repo",storageBucket:"main-repo.appspot.com",messagingSenderId:"682912307930",appId:"1:682912307930:web:065128b1ab322a66"};firebase.initializeApp(c);const d=firebase.firestore(),u=firebase.messaging();var v={data(){return{api:void 0,authorized:!1,navItems:[{title:"Introduction",target:"#intro"},{title:"Authentication",target:"#auth"},{title:"Manage events",target:"#manage"},{title:"Google Calendar",target:"#gCal"},{title:"Submit new events",target:"#submit"},{title:"Subscribe to new events",target:"#subscribe"}],nav:!0,submittedEvents:[],pulledEvents:[],search:"",submittedEvents_headers:[{text:"Title",value:"summary",sortable:"true"},{text:"Submitted By",value:"submitted_by",sortable:"true"},{text:"Topics",value:"topics",sortable:"true"},{text:"Start",value:"start.dateTime",sortable:"true"},{text:"End",value:"end.dateTime"},{text:"Location",value:"location",sortable:"true"}],events_headers:[{text:"Title",value:"summary",sortable:"true"},{text:"Start",value:"start.dateTime",sortable:"true"},{text:"End",value:"end.dateTime"},{text:"Location",value:"location",sortable:"true"}],selectedEvents:[],active_tab:1,rejecting:!1,rejecting_why:"",iframe_key:0,valid:!0,firstNameRules:[e=>!!e||"Name is required",e=>e&&e.length<=25||"Name must be less than 10 characters"],lastNameRules:[e=>!!e||"Name is required",e=>e&&e.length<=25||"Name must be less than 10 characters"],emailRules:[e=>!!e||"E-mail is required",e=>/.+@.+\..+/.test(e)||"E-mail must be valid"],phoneRules:[e=>!!e||"Phone number is required",e=>/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(e.trim())||"Phone number must be valid"],schools_opts:["Goju Kan Bern","Wutan Thun","Zenshin Basel","Kungfu21","Taekwondo Schule Basel","Training Center Fribourg"],dates:[],refDate:(new Date).toISOString().substr(0,10),pickerDate:null,author:{firstName:"",lastName:"",email:"",phone:"",is_school:null,school:""},event:{title:"",location:"",start:"",end:"",time:"09:00",arts:["Bagua","Baji","Tai chi"],levels:["Beginners","Advanced"],privacy:null,discount:null,registration:null,registration_details:"",comment:"",topics:["Wutan Official","CH Seminars","TW Seminars"]},user:{topics:["Wutan Official"],notifs_prefs:["Email","Web push"],reminders:["added","1 week before"],emailNotif:"",gUserEmail:"",name:"",token:""},arts_opts:["Bagua","Baji","Tai chi","Kung Fu","Mizongyi","Xing Yi"],levels_opts:["Beginners","Advanced"],fillFrom_opts:["fill from email","fill from phone","fill from school"],topics_opts:["Wutan Official","CH Seminars","TW Seminars"],reminders_opts:["added","updated or cancelled","1 week before","2 days before"],locked:!1,notifs_opts:["Email","Web push"],notif_snackbar:!1,push_snackbar:!1,newNotif:"",newWebPush:""}},created(){this.api=gapi,this.loadGapiClient(),this.initMessaging(),this.checkSignedIn()},mounted(){console.log("Loaded in (sec)",performance.now()-l)},computed:{events(){return this.pulledEvents.length>0?this.pulledEvents:[]},thisMonthEvents(){return this.events.filter(e=>this.refDate.substr(0,7)==e.start.dateTime.substr(0,7))},locker(){return this.locked?"Unlock email address":"Lock email address"}},methods:{initMessaging(){u.usePublicVapidKey("BJV_rKOrznrxId6JaxqYzlt7HcHjCK-c5S4062SL-dCqDtDkFs5fxifKdAtSyy3OIovPzhRC_O33reZbzBa1O6E"),u.onTokenRefresh(()=>{u.getToken().then(e=>{console.log("Token refreshed."),this.user.token=e,d.collection("swiss-wutan-subscribed").doc(this.user.gUserEmail).update({push_token:e})}).catch(e=>{console.log("Unable to retrieve refreshed token ",e),showToken("Unable to retrieve refreshed token ",e)})}),u.onMessage(e=>{this.newWebPush="NEW NOTIFICATION. "+e["notification"]["title"]+"\n"+e["notification"]["body"]})},checkSignedIn(){firebase.auth().onAuthStateChanged(e=>{e?(this.user.gUserEmail=e.email,this.user.name=e.displayName,this.newNotif="Hi again, "+this.user.name,this.updateUI(!0)):this.updateUI(!1)})},signIn(){const e=new firebase.auth.GoogleAuthProvider;e.addScope("https://www.googleapis.com/auth/calendar"),firebase.auth().signInWithPopup(e).then((function(e){this.updateUI(!0)})).catch((function(e){console.error(e)}))},signOut(){firebase.auth().signOut().then(()=>{console.log("User signed out"),this.updateUI(!1)})},updateUI(e){e?this.pullSubmittedEvents().then(e=>{this.submittedEvents=e,this.authorized=!0,this.active_tab=0;let t=d.collection("swiss-wutan-subscribed").doc(this.user.gUserEmail);t.get().then(e=>{e.exists?(this.user.notifs_prefs=e.data().notifs_prefs||[],this.user.token=e.data().token||"",this.user.emailNotif=this.user.gUserEmail,this.user.topics=e.data().topics||[],this.user.reminders=e.data().reminders||[],this.locked=!0):t.set({email:this.user.gUserEmail,created_on:firebase.firestore.FieldValue.serverTimestamp()})})}):(this.submittedEvents=[],this.authorized=!1,this.active_tab=1),this.authorized=e},loadGapiClient(){this.api.load("client:auth2",this.initClient)},initClient(){let e=this;e.api.client.init({apiKey:"AIzaSyBzpFzhzVLPaQBH3r0WVv9Jg9dDJnM15Hw",clientId:"269173845983-bh57obunpvb47omgcbm6fq7nk3ube1mu.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:"https://www.googleapis.com/auth/calendar",calendar:"3mo0a639qfhs9tjc1idmu4kkus@group.calendar.google.com"}).then(e=>this.pullScheduled()).then(e=>this.pulledEvents=e)},pullScheduled(){let e=this;return e.api.client.calendar.events.list({calendarId:"3mo0a639qfhs9tjc1idmu4kkus@group.calendar.google.com",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"}).then(e=>{return e.result.items.map(e=>{return{local_id:Math.floor(Math.random()*Math.floor(1e3)).toString(),validation_status:"accepted",summary:e.summary,description:e.description,location:e.location,start:{dateTime:e.start.dateTime},end:{dateTime:e.end.dateTime}}})})},pullSubmittedEvents(){return d.collection("swiss-wutan-events").where("validation_status","==","submitted").get().then(e=>e.docs.map(e=>({id:e.id,...e.data()}))).catch(e=>console.log(JSON.stringify(e)))},acceptSubmitted(){const e=this,t=["status","updated","htmlLink","summary","description","location","start","end","organizer","creator","source","reminders"],a=e=>{for(let a in e)t.includes(a)||delete e[a];return e},s=this.selectedEvents.filter(e=>"submitted"===e["validation_status"]);let i=s.length;Promise.all(s.map(e=>d.collection("swiss-wutan-events").doc(e.id).update({validation_status:"accepted"}))).then(()=>{s.forEach(t=>{let s=e.api.client.calendar.events.insert({calendarId:"3mo0a639qfhs9tjc1idmu4kkus@group.calendar.google.com",resource:a(t)});s.execute(()=>{this.updateUI(this.authorized)})})}).then(()=>this.newNotif=i.toString()+" event(s) accepted!").catch(e=>{console.error("This went wrong",e),this.newNotif="Something went wrong. Please get in touch."})},sendRejection(){console.log("rejected")},refreshFrame(){this.iframe_key+=1},submitEvent(){this.$refs.form.validate()?(d.collection("swiss-wutan-events").add({summary:this.eventTitle,location:this.eventLocation,description:this.comments,start:{dateTime:this.eventStart,timeZone:"Europe/Zurich"},end:{dateTime:this.eventEnd,timeZone:"Europe/Zurich"},topics:this.topics,submitted_by:this.user.gUserEmail,validation_status:"submitted"}),this.newNotif="Event submitted!"):this.newNotif="Please correct the form first."},reset(){this.$refs.form.reset()},resetValidation(){this.$refs.form.resetValidation()},lockUnlock(){this.locked?this.locked=!1:this.locked=!0},subUnsub(e){let t=e?this.user.emailNotif:this.user.gUserEmail;d.collection("swiss-wutan-subscribed").doc(this.user.gUserEmail).update({notifs_prefs:this.user.notifs_prefs,email:t,topics:this.user.topics,reminders:this.user.reminders}).catch(e=>this.newNotif="An error occurred "+e),this.newNotif="Subscription edited!"},testEmail(){alert("To test this feature, make sure you have registered to Wutan Official and are accepting notifications via emails. Then select the submitted event above, and click the ACCEPT SUBMITTED EVENT button.")},testPush(){Notification.requestPermission().then(e=>{"granted"===e?u.getToken().then(e=>{e?(d.collection("swiss-wutan-subscribed").doc(this.user.gUserEmail).update({push_token:e}),setTimeout(()=>{this.sendPush(e)},2e3),alert("A notification will be issued after you close this window. Switch now to another tab or window to see the background notification. Or stay here to see the foreground notification.")):(console.log("No Instance ID token available. Request permission to generate one."),console.log("Got this token",e))}).catch(e=>{console.log("An error occurred while retrieving token. ",e),console.error("Error retrieving Instance ID token. ",e)}):console.log("Unable to get permission to notify.")})},sendPush(e){let t="AAAAnwC-2to:APA91bG4Ehb9g8Gt7vjMyqO5-S5EL8XD0ZpJaEWXpHF6wm2AusPieTcSjfvO_ya6izP7cU5L0CWV1xs3eeS-rhg0TERFowF_0QZtyYLSzMfvdyM6NRQG9ncR-oUXHg_IpO1YuNttWtYN",a={title:"You have the KUNG-FU!",body:"Yet, your journey is only beginning",click_action:"https://swiss-wutan-calendar-beta.netlify.com/"};fetch("https://fcm.googleapis.com/fcm/send",{method:"POST",headers:{Authorization:"key="+t,"Content-Type":"application/json"},body:JSON.stringify({notification:a,to:e})}).then((function(e){console.log(e)})).catch((function(e){console.error(e)}))}},watch:{pickerDate(e){this.refDate=e},newNotif(e){this.notif_snackbar=!0},newWebPush(e){this.push_snackbar=!0}}},h=v,m=a("2877"),b=a("6544"),p=a.n(b),f=a("8336"),g=a("b0af"),k=a("99d9"),_=a("ac7c"),w=a("62ad"),y=a("2b5d"),x=a("a523"),E=a("a75b"),T=a("8fea"),S=a("2e4b"),N=a("169a"),C=a("ce7e"),I=a("4bd4"),j=a("132d"),A=a("8860"),V=a("da13"),P=a("5d23"),U=a("f774"),O=a("0fd9"),z=a("b974"),D=a("2db4"),W=a("71a3"),F=a("c671"),$=a("fe57"),R=a("8654"),q=a("a844"),M=a("71d9"),B=a("2a7f"),L=Object(m["a"])(h,o,r,!1,null,null,null),G=L.exports;p()(L,{VBtn:f["a"],VCard:g["a"],VCardActions:k["a"],VCardText:k["b"],VCardTitle:k["c"],VCheckbox:_["a"],VCol:w["a"],VCombobox:y["a"],VContainer:x["a"],VContent:E["a"],VDataTable:T["a"],VDatePicker:S["a"],VDialog:N["a"],VDivider:C["a"],VForm:I["a"],VIcon:j["a"],VList:A["a"],VListItem:V["a"],VListItemContent:P["a"],VListItemTitle:P["b"],VNavigationDrawer:U["a"],VRow:O["a"],VSelect:z["a"],VSnackbar:D["a"],VTab:W["a"],VTabItem:F["a"],VTabs:$["a"],VTextField:R["a"],VTextarea:q["a"],VToolbar:M["a"],VToolbarTitle:B["a"]});var Z={name:"App",components:{Singleton:G},data:()=>({})},Y=Z,H=a("7496"),J=a("40dc"),K=a("2fa4"),X=Object(m["a"])(Y,i,n,!1,null,null,null),Q=X.exports;p()(X,{VApp:H["a"],VAppBar:J["a"],VContent:E["a"],VSpacer:K["a"],VToolbarTitle:B["a"]});var ee=a("f309");s["a"].use(ee["a"]);var te=new ee["a"]({icons:{iconfont:"mdi"}});s["a"].config.productionTip=!1,new s["a"]({vuetify:te,render:e=>e(Q)}).$mount("#app")}});
//# sourceMappingURL=app.8b5711ba.js.map