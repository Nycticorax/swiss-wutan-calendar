<!DOCTYPE html>
<html>

<head>
	<title>Swiss Wutan's Unique Centralized Calendar Everyone Ever Wished We Had But Never Dared to Ask For</title>
	<meta charset="utf-8" />
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.css" />
	<link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
</head>

<body>
	<div id="app">
		<v-app>
			<!-- NAV -->
			<v-card raised outlined dark style="position: fixed; right:0; margin:0; padding:0; z-index:9999">
				<v-navigation-drawer v-model="nav" expand-on-hover permanent>
					<v-list-item>
						<v-list-item-title>NAV</v-list-item-title>
						<v-btn icon @click.stop="nav = !nav">
							<v-icon>mdi-chevron-left</v-icon>
						</v-btn>
					</v-list-item>
					<v-divider></v-divider>
					<v-list dense rounded>
						<v-list-item v-for="i in navItems" :key="i.name" link>
							<v-list-item-content>
								<v-list-item-title @click="$vuetify.goTo(i.target)">{{ i.title }}</v-list-item-title>
							</v-list-item-content>
						</v-list-item>
					</v-list>
				</v-navigation-drawer>
			</v-card>
			<v-content>
				<!-- INTRO -->
				<v-container>
					<v-card>
						<v-toolbar id="intro" flat color="red darken-2" dark>
							<v-toolbar-title>Introduction</v-toolbar-title>
						</v-toolbar>
						<v-card-text>
							<p>The goal of this page is to demo a workable, in-house
								alternative to Facebook for managing Swiss Wutan's events. Reasons to go all-in with
								Facebook are (a) Facebook is the ultimate owner of the content it hosts; (b) Facebook
								has a
								poor record in protecting users' privacy, (c) Facebook is extremely opaque and has poor
								programming interfaces and finally (d) it's always good not to put all one's eggs in the
								same basket, i.e. not assume everyone likes to use Facebook for managing
								community-driven time schedules. And if you still are in love with Facebook you can use
								<a href="https://www.facebook.com/help/152652248136178/">these instructions</a> to
								export Facebook's events to Google Calendar.</p>
							<p>Onto the concept. It works like this.</p>
							<ol>
								<li>Anyone -- perhaps an individual or
									institutional member of Swiss Wutan, but not necessarily -- can submit events to
									the
									SWISS WUTAN CALENDAR -- displayed here below</li>
								<li>Submitted events don't need to be organized by Swiss Wutan or affiliates. They
									can just be interested for our community, or for some schools, etc. It's very
									easy with this setup to create different categories for events, and to search
									them smoothly.</li>
								<li>People vested with an
									"admin" role can accept or reject events submissions. This process is explained
									below.</li>
							</ol>
							At the end of the day this removes all the bureaucratic shenanigans so that we can all
							focus on what matters -- <em>Wutan!</em> (For the curious, source code is sleeping <a
								href="https://github.com/Nycticorax/swiss-wutan-calendar">here</a>.)
						</v-card-text>
					</v-card>
				</v-container>
				<v-container>
					<v-card>
						<v-toolbar id="auth" flat color="red darken-2" dark>
							<v-toolbar-title>Authenticate on Google Calendar</v-toolbar-title>
						</v-toolbar>
						<v-card class="d-flex pa-2" outlined tile>
							<v-card-actions>
								<v-btn v-if="!authorized" @click="signIn()">Log in</v-btn>
								<v-btn v-else @click="signOut()">Log out</v-btn>
							</v-card-actions>
							<v-card-text>Acquire admin credentials here. Please note that you will need a Google Account
								to make the most of this demo. Email + password login will be available.</v-card-text>
						</v-card>
					</v-card>
				</v-container>
				<v-container>
					<v-card>
						<v-toolbar id="manage" flat color="red darken-2" dark>
							<v-toolbar-title>Accept or reject events submissions</v-toolbar-title>
						</v-toolbar>
						<v-card-text>This section lets you switch between events submitted but not yet
							validated (i.e. accepted or rejected) and events already scheduled events.</v-card-text>
						<v-card class="d-flex pa-2" outlined tile>
							<v-tabs color="red darken-2" v-model="active_tab" vertical>
								<v-tab key="0">Submitted events</v-tab>
								<v-tab key="1">Scheduled events</v-tab>
								<!-- SUBMITTED EVENTS LIST -->
								<v-tab-item key="0">
									<v-card flat>
										<div v-if="authorized">
											<v-card-title>
												<v-text-field v-model="search" label="Search" single-line hide-details>
												</v-text-field>
											</v-card-title>
											<v-data-table v-if="submittedEvents" v-model="selectedEvents"
												:headers="submittedEvents_headers" :items="submittedEvents" show-select
												sort-by="start.dateTime" :sort-desc="true" item-key="id"
												:search="search" :items-per-page="10" class="elevation-1">
											</v-data-table>
										</div>
										<div v-else>
											<v-card-text>You need to be logged in to see submitted events.</v-card-text>
										</div>
									</v-card>
								</v-tab-item>
								<!-- CONFIRMED EVENTS LIST -->
								<v-tab-item key="1">
									<v-card flat>
										<v-card-title>
											<v-text-field v-model="search" label="Search" single-line hide-details>
											</v-text-field>
										</v-card-title>
										<v-data-table v-if="events" v-model="selectedEvents" :headers="events_headers"
											:items="events" show-select :items-per-page="10" class="elevation-1"
											sort-by="start.dateTime" :sort-desc="true" item-key="id" :search="search">
										</v-data-table>
									</v-card>
								</v-tab-item>
							</v-tabs>
						</v-card>
						<!-- ON DISPLAY -->
						<div id="subscribe" v-if="selectedEvents.length > 0">
							<v-divider></v-divider>
							<v-card v-for="se in selectedEvents" :key="se.id" class="mx-auto" tile>
								<v-card-title>{{se.summary}}</v-card-title>
								<v-list-item>
									<v-list-item-content>
										<v-list-item-title>{{ se.author || "author" }}</v-list-item-title>
									</v-list-item-content>
								</v-list-item>
								<v-list-item>
									<v-list-item-content>
										<v-list-item-title>{{se.start.dateTime}}</v-list-item-title>
									</v-list-item-content>
								</v-list-item>
								<v-list-item>
									<v-list-item-content>
										<v-list-item-title>{{se.end.dateTime || "no end specified"}}</v-list-item-title>
									</v-list-item-content>
								</v-list-item>
								<v-list-item>
									<v-list-item-content>
										<v-list-item-title>{{se.location || "Wudan Mountains"}}</v-list-item-title>
									</v-list-item-content>
								</v-list-item>
							</v-card>
						</div>
						<!-- ACCEPT / REJECT -->
						<v-card-actions>
							<v-btn v-if="authorized && active_tab == 0 && selectedEvents.length > 0"
								@click="acceptSubmitted()">
								Accept submitted event(s)</v-btn>
							<v-btn v-else-if="authorized" disabled>Accept submitted
								event(s)</v-btn>
							<v-btn v-if="authorized && active_tab == 0 && selectedEvents.length > 0"
								@click="rejecting = !rejecting">Reject
								submitted event(s)</v-btn>
							<v-btn v-else-if='authorized' disabled>Reject submitted
								event(s)</v-btn>
						</v-card-actions>
					</v-card>
					<!-- REJECTING SUBMITTED EVENTS -->
				</v-container>
				<v-dialog v-if="rejecting" v-model="rejecting" persistent max-width="450">
					<v-card>
						<v-card-title class="headline">Explain why</v-card-title>
						<v-textarea v-model="rejecting_why" auto-grow
							placeholder="Please explain the submitter why you're rejecting." rows="4" row-height="30">
						</v-textarea>
						<v-card-actions>
							<div class="flex-grow-1"></div>
							<v-btn color="green darken-1" text @click="rejecting = false; sendRejection()">Confirm &
								send</v-btn>
							<v-btn color="orange darken-1" text @click="rejecting = false">Cancel rejection</v-btn>
						</v-card-actions>
					</v-card>
				</v-dialog>
				<v-container>
					<v-card>
						<v-toolbar id="gCal" flat color="red darken-2" dark>
							<v-toolbar-title>Check the results</v-toolbar-title>
						</v-toolbar>
						<v-card-text>
							<p>This is NOT the actual calendar used to review and submit events (see below for the real
								calendar). This is just the "official" interface Google provides for interacting with
								events. I am putting it here simply to show that accepting submitted events works. By
								the way it is visible by
								anyone on
								the internet -- no credentials required. Here's its <a
									href="https://calendar.google.com/calendar/embed?src=3mo0a639qfhs9tjc1idmu4kkus%40group.calendar.google.com&ctz=Europe%2FZurich">home
									page</a>. Also, remember that Google Calendars have many
								features:</p>
							<ol>
								<li>can share links to expose any calendar</li>
								<li>can link up any two calendars, so that can explose each other's events</li>
								<li>custom email & push notifications.</li>
								<li>available on many different platforms --
									Web, Android, iPhone</li>
							</ol>
							<p>If you have accepted events submissions you can now hit <v-btn @click="refreshFrame">
									reload</v-btn> to see the results of the newly validated events.</p>

						</v-card-text>
						<v-card class="d-flex pa-2" outlined tile>
							<div :key="iframe_key">
								<iframe
									src="https://calendar.google.com/calendar/embed?height=450&amp;wkst=2&amp;bgcolor=%23D50000&amp;ctz=Europe%2FZurich&amp;src=M21vMGE2MzlxZmhzOXRqYzFpZG11NGtrdXNAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&amp;color=%23D50000&amp;showTitle=1&amp;showNav=1&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;hl=de"
									style="border-width:0" width="450" height="450" frameborder="0"
									scrolling="no"></iframe>
							</div>
						</v-card>
					</v-card>
				</v-container>
				<v-container>
					<!-- FORM -->
					<v-card>
						<v-toolbar id="submit" flat color="red darken-2" dark>
							<v-toolbar-title>Submit new events</v-toolbar-title>
						</v-toolbar>
						<v-card-text>By contrast to the other sections of the page, this one will be visible to anyone
							on the internet. People are supposed to use it to submit new events.</v-card-text>
						<v-card class="d-flex pa-2" outlined tile>
							<v-form ref="form" v-model="valid" lazy-validation>
								<v-container>
									<v-row>
										<!-- SUBMITTER INFO -->
										<v-col cols="12" md="4">
											<v-text-field v-model="author.firstName" :counter="25"
												:rules="firstNameRules" outlined label="First name" required>
											</v-text-field>
											<v-text-field v-model="author.lastName" :counter="25" :rules="lastNameRules"
												outlined label="Last name" required>
											</v-text-field>
										</v-col>
										<v-col cols="12" md="4">
											<v-text-field v-model="author.email" :rules="emailRules" label="Email"
												required outlined>
											</v-text-field>
											<v-text-field v-model="author.phone" :rules="phoneRules"
												label="Phone number" required outlined></v-text-field>
										</v-col>
										<v-col cols="12" md="4">
											<v-checkbox v-model="author.is_school" color="red darken-2"
												label="I am submitting on behalf of a Swiss Wutan school"></v-checkbox>
											<v-select v-if="author.is_school" v-model="author.school"
												:items="schools_opts" label="School" outlined
												:rules="[v => !!v || 'Deselect the previous checkbox or please do mention your school']"
												required></v-select>
										</v-col>
										<!-- DATES -->
										<v-col cols="12" sm="6" class="my-2 px-1">
											<v-date-picker ref="picker" v-model="dates" multiple color="red darken-2"
												:picker-date.sync="pickerDate" full-width></v-date-picker>
										</v-col>
										<v-col cols="12" sm="6" class="my-2 px-1">
											<div class="title">Real calendar for all users (not only admins)</div>
											<div class="subheader">Switch to October to see the scheduled events.
											</div>
											<ul class="ma-4">
												<li v-for="e in thisMonthEvents">{{ e.summary }}{{ e.start.dateTime }}
												</li>
											</ul>
											<br /><br />
											<v-combobox v-model="dates" multiple chips :items="dates"
												label="Dates picked" deletable-chips></v-combobox>
											<v-text-field label="Time" v-model="event.time" type="time"></v-text-field>
										</v-col>
										<!-- EVENT CONTENT -->
										<v-col cols="12" md="6">
											<v-text-field v-model="event.title" label="Event title" filled required>
											</v-text-field>
											<v-select :items="levels_opts" v-model="event.levels"
												label="Suggested level(s)" deletable-chips multiple chips>
											</v-select>
										</v-col>
										<v-col cols="12" md="6">
											<v-text-field v-model="event.location" label="Event location" filled
												required>
											</v-text-field>
											<v-combobox v-model="event.arts" deletable-chips multiple chips
												:items="arts_opts" label="Featured styles"></v-combobox>
										</v-col>
										<!-- MORE CHECKBOXES -->
										<v-col cols="12" md="6">
											<v-combobox v-model="event.topics" multiple chips :items="topics_opts"
												label="Topics" deletable-chips></v-combobox>
										</v-col>
										<v-col cols="12" md="6">
											<v-checkbox v-model="event.privacy" color="red darken-2"
												label="This event is meant only for Swiss Wutan members">
											</v-checkbox>
											<v-checkbox v-model="event.registration" color="red darken-2"
												label="Registration required">
											</v-checkbox>
											<div id="register" v-if=event.registration>
												<v-combobox v-model="event.registration_details" :items="fillFromOpts"
													filled label="Participants register here (url, email):....">
												</v-combobox>
											</div>
											<v-checkbox v-model="event.discount" color="red darken-2"
												label="Swiss Wutan members get a special discount">
											</v-checkbox>
										</v-col>

										<!-- COMMENTS -->
										<v-container fluid>
											<v-textarea label="If appropriate please describe the event." auto-grow
												outlined shaped v-model="event.comments"></v-textarea>
										</v-container>
										<!-- SUBMIT -->
										<v-btn :disabled="!valid" color="success" class="mr-4" @click="submitEvent()">
											Validate
										</v-btn>
										<v-btn color="error" class="mr-4" @click="reset">
											Reset Form
										</v-btn>
										<v-btn color="warning" @click="resetValidation">
											Reset Validation
										</v-btn>
									</v-row>
								</v-container>
							</v-form>
						</v-card>
					</v-card>
				</v-container>
				<!-- SUBSCRIBE -->
				<v-container>
					<v-card>
						<v-toolbar id="subscribe" flat color="red darken-2" dark>
							<v-toolbar-title>Subscribe</v-toolbar-title>
						</v-toolbar>
						<!-- <v-card-title></v-card-title> -->
						<v-card-text>You need to be logged in to use this feature. Here users can manage their
							subscriptions to 'topics', namely theme-related events
							about which they want to be notified. Notifications can be sent as emails or web push. Play
							around to see them in action.</v-card-text>
						<v-divider></v-divider>
						<v-form>
							<v-container>
								<v-row>
									<v-col cols="12" md="4">
										<v-text-field v-if="locked" v-model="user.emailNotif" readonly outlined filled
											label="Email" :placeholder="user.gUserEmail || user.emailNotif || ''"
											@click:append-outer="lockUnlock" append-outer-icon="mdi-lock-reset">
										</v-text-field>
										<v-text-field v-else v-model="user.emailNotif" outlined label="Email"
											:placeholder="user.gUserEmail || user.emailNotif || 'Your email'"
											@click:append-outer="lockUnlock" append-outer-icon="mdi-lock-reset">
										</v-text-field>
									</v-col>
									<v-col cols="12" md="4">
										<v-combobox v-model="user.notifs_prefs" :items="notifs_opts" multiple chips
											deletable-chips label="Notifications"></v-combobox>
										<v-combobox v-model="user.reminders" :items="reminders_opts" multiple chips
											deletable-chips label="Notifications"></v-combobox>
									</v-col>
									<v-col cols="12" md="4">
										<v-combobox v-model="user.topics" multiple chips :items="topics_opts" label="Topics"
											deletable-chips></v-combobox>
										<v-btn class="ma-2" outlined text color="primary" @click="testEmail">Test email
										</v-btn>
										<v-btn class="ma-2" outlined text color="primary" @click="testPush">Test web
											push</v-btn>
									</v-col>
								</v-row>
								<v-btn v-if="authorized && user.emailNotif !== user.gUserEmail" color="success"
									@click="subUnsub(true)">
									Subscribe</v-btn>
								<v-btn v-else disabled color="success">Already subscribed</v-btn>
								<v-btn v-if="authorized && user.emailNotif === user.gUserEmail" color="warning"
									@click="subUnsub(false)">
									Edit subscription</v-btn>
								<v-btn v-else disabled color="error">Unsubscribe</v-btn>
							</v-container>
						</v-form>
					</v-card>
				</v-container>
			</v-content>
			<v-snackbar v-if="newNotif" v-model="snackbar">{{ newNotif }}
				<v-btn color="pink" text @click="snackbar = false">
					Close
				</v-btn>
			</v-snackbar>
		</v-app>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
	<!-- FIREBASE & FIRESTORE-->
	<script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-auth.js"></script>
	<script src="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.js"></script>
	<script src="https://www.gstatic.com/firebasejs/6.3.4/firebase-messaging.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.0.0/firebase-functions.js"></script>
	<script src="https://apis.google.com/js/api.js"></script>
	<script src="vue_inject.js"></script>
</body>

</html>